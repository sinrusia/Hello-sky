<?xml version="1.0"?>

<project name="openamf" default="init" basedir=".">


	<property name="build.dir" location="classes"/>
	<property name="fetched.dir" location="${build.dir}/fetched"/>
	<property name="generated.dir" location="${build.dir}"/>
	<!--
	<property name="packagename" value="amazon" />
	
	<property name="endpoint" value="http://soap.amazon.com/schemas2/AmazonWebServices.wsdl" />
	-->
	
	 <path id="project.class.path">
		<fileset dir="lib">
			<include name="**/*.jar" />      
		</fileset>
	</path>
	
	
	<property name="lib.dir" value="lib" />
	
	<property name="axis.dir" location="${lib.dir}" />
	<property name="xercesxalan.dir" location="${lib.dir}" />
	
	
	
	<target name="init">
		<mkdir dir="${fetched.dir}"/>
		<mkdir dir="${generated.dir}"/>
		<condition property="offline">
		<not>
		<http url="${endpoint}"/>
		
		</not>
		</condition>
	</target>
	
	<target name="fetch-wsdl" depends="init" unless="offline">
		<get src="${endpoint}" dest="${fetched.dir}/api.wsdl"/>
	</target>
	
	
	<path id="axis.classpath">
		<fileset dir="lib">
			<include name="**/*.jar" />
		</fileset>
		<fileset dir="${axis.dir}">
		<include name="**/*.jar"/>
		</fileset>
		<fileset dir="${xercesxalan.dir}">
		<include name="*.jar"/>
		</fileset>
	</path>
	
	
	<target name="import-wsdl" depends="fetch-wsdl">
		<java 
			classname="org.apache.axis.wsdl.WSDL2Java" 
			fork="true" 
			failonerror="true" 
			classpathref="project.class.path">
		
			<!-- TODO change this -->
		
			<arg file="${fetched.dir}/api.wsdl"/>
			<arg value="--output"/>
			<arg file="${generated.dir}"/>
			<arg value="--verbose"/>
			<arg value="--package"/>
			<!-- file value minus any urn: and .wsdl -->
			<arg value="${packagename}"/>
		</java>
	</target>
	
	
	
	<target name="compile" depends="import-wsdl">
		<javac 
			srcdir="${generated.dir}" 
			fork="true" 
			destdir="${generated.dir}" 
			classpathref="axis.classpath" 
			debuglevel="lines,vars,source" 
			debug="true" 
			includeAntRuntime="false" 
		/>
	</target>

</project>