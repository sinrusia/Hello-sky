<?xml version="1.0" encoding="utf-8"?>
<!--
/////////////////////////////////////////////////////////////////////////////////////////////
//
// Copyright (C) 2004-2012 WeMB INC. 
// All Rights Reserved.
//
//	@auther			: Jang Mi-Hwa
//	@description 	: 우측 상단 LinkBar
//	
/////////////////////////////////////////////////////////////////////////////////////////////
-->
<s:Group xmlns:fx="http://ns.adobe.com/mxml/2009" 
		 xmlns:s="library://ns.adobe.com/flex/spark" 
		 xmlns:mx="library://ns.adobe.com/flex/mx">
	
	<fx:Metadata>
		[Event(name="subMenuClickEvent", type="com.wemb.tobit.events.MenuEvent")]
	</fx:Metadata>
	
	<fx:Script>
		<![CDATA[
			import com.wemb.puremvc.patterns.observer.Notification;
			import com.wemb.tobit.events.MenuEvent;
			import com.wemb.tobit.pure.ApplicationFacade;
			import com.wemb.tobit.pure.Constants;
			import com.wemb.tobit.vo.MenuInfo;
			import com.wemb.tobit.vo.PageInfo;
			
			import mx.collections.ArrayCollection;
			import mx.events.ItemClickEvent;
			
			
			//---------------------------------
			// Variables
			//---------------------------------
			[Bindable] private var _dataProvider:ArrayCollection;
			private var _changed:Boolean = false;
			
			
			//---------------------------------
			// Setter / Getter
			//---------------------------------
			public function set dataProvider(value:Object):void
			{
				if(value is Array)
				{
					_dataProvider = new ArrayCollection(value as Array);
				}
				else if(value is ArrayCollection)
				{
					_dataProvider = value as ArrayCollection;
				}
				else
				{
					_dataProvider = null;
				}
				
				//if(_dataProvider && _dataProvider.length > 0) {
				//	bg.visible = true;
				//} else {
				//	bg.visible = false;
				//}
				
				_changed = true;
				invalidateDisplayList();
			}
			
			public function get dataProvider():Object
			{
				return _dataProvider;
			}
			
			
			//---------------------------------
			// Override
			//---------------------------------
			override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void
			{
				super.updateDisplayList(unscaledWidth, unscaledHeight);
			}
			
			
			//---------------------------------
			// function
			//---------------------------------
			private function clickHandler(event:ItemClickEvent):void
			{
				if(event.item)
				{
					var menuEvent:MenuEvent = new MenuEvent("subMenuClickEvent");
					menuEvent.selectedMenu  = event.item as MenuInfo;
					dispatchEvent(menuEvent);
					
					pageChange(event.item as MenuInfo);
				}
			}
			
			private function pageChange(menuInfo:MenuInfo):void
			{
				menuInfo = MainMenuBar.getOpenPageMenu(menuInfo);
				
				var info:PageInfo	= new PageInfo();
				info.menuId			= menuInfo.id;
				info.url			= menuInfo.url;
				info.pageType		= menuInfo.type;
				info.menuName		= menuInfo.name;
				info.initInfo		= menuInfo;
				
				var facade:ApplicationFacade = ApplicationFacade.getInstance();
				facade.sendNotification(Notification.PAGE_CHANGE, info);
			}
			
			public function containsMenu(menuInfo:MenuInfo):Boolean
			{
				if (_dataProvider) 
				{
					for each (var info:MenuInfo in _dataProvider.source) {
						if(info.id == menuInfo.id)
							return true;
					}
				}
				return false;
			}
		]]>
	</fx:Script>
	<!--
	<s:BitmapImage id="bg" left="0" right="0" top="-7" visible="false"
				   source="@Embed('/assets/common/box.png', 
				   scaleGridLeft='16', scaleGridRight='18',
				   scaleGridTop='0', scaleGridBottom='37')"/>-->
	
	<mx:LinkBar id="linkBar" itemClick="clickHandler(event)" 
				dataProvider="{_dataProvider}" labelField="name"/>
</s:Group>
